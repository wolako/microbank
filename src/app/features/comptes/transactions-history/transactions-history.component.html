<div class="transactions-history container py-4">
  <h2 class="mb-4">üìÑ Historique des transactions</h2>

  <!-- üîç Filtres dans une carte -->
  <div class="filter-card mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-6">
        <label class="form-label">Filtrer par type :</label>
        <select class="form-select" [(ngModel)]="filterType" (change)="applyFilter()">
          <option value="">Tous</option>
          <option value="deposit_manual">D√©p√¥t manuel</option>
          <option value="deposit_mobile">D√©p√¥t Mobile</option>
          <option value="deposit_card">D√©p√¥t Carte</option>
          <option value="deposit_wire">D√©p√¥t virement</option>
          <option value="withdrawal_mobile">Retrait Mobile Money</option>
          <option value="withdrawal_card">Retrait Carte bancaire</option>
          <option value="withdrawal_atm">Retrait Guichet automatique</option>
          <option value="transfer">Transfert</option>
          <option value="wire">Virement</option>
          <option value="bill_payment">Paiement facture</option>
          <option value="purchase">Achat en ligne</option>
        </select>
      </div>
      <div class="col-md-6">
        <label class="form-label">Filtrer par canal :</label>
        <select class="form-select" [(ngModel)]="filterChannel" (change)="applyFilter()">
          <option value="">Tous</option>
          <option *ngFor="let ch of availableChannels" [value]="ch">{{ ch }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- üìã Liste des transactions -->
  <div *ngIf="filteredTransactions.length > 0; else noData">
    <div class="table-responsive rounded shadow-sm">
      <table class="table table-dark table-hover table-striped align-middle rounded">
        <thead class="thead-dark">
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Description</th>
            <th>Montant</th>
            <th>Solde apr√®s</th>
            <th>Canal</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tx of paginatedTransactions()">
            <td>{{ tx.created_at | date:'d MMMM y √† HH:mm' }}</td>
            <td>
              <i [class]="getIcon(tx.type)" class="me-1"></i>
              {{ formatType(tx.type) }}
            </td>
            <td>{{ tx.description }}</td>
            <td [class.text-success]="tx.amount > 0" [class.text-danger]="tx.amount < 0">
              {{ tx.amount | currencyXof }}
            </td>
            <td>{{ tx.balance_after | currencyXof }}</td>
            <td>{{ tx.channel || '‚Äî' }}</td>
            <td>
              <a [routerLink]="['/transactions', tx.id]" class="btn btn-sm btn-outline-info me-2">üßæ Voir</a>
              <button class="btn btn-sm btn-outline-light" (click)="printReceipt(tx)">üñ®Ô∏è Re√ßu</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- üìå Pagination -->
    <nav aria-label="Page navigation" class="mt-3">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="goToPage(currentPage - 1)">Pr√©c√©dent</a>
        </li>
        <li
          class="page-item"
          *ngFor="let page of totalPages()"
          [class.active]="page === currentPage"
        >
          <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages().length">
          <a class="page-link" (click)="goToPage(currentPage + 1)">Suivant</a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- ‚ùó Aucune donn√©e -->
  <ng-template #noData>
    <div class="alert alert-info">Aucune transaction √† afficher pour le moment.</div>
  </ng-template>

  <!-- üìä R√©sum√© mensuel -->
  <div class="mt-5 card bg-dark text-white border-0 shadow-sm rounded">
    <div class="card-body">
      <h4 class="card-title">üìä R√©sum√© mensuel des transactions</h4>
      <canvas id="monthlyChart" height="100"></canvas>
    </div>
  </div>
</div>
